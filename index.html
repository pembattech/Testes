<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Expense Tracker</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root {
      --primary: #2a9d8f;
      --accent: #e9c46a;
      --danger: #e76f51;
      --bg: #f4f4f4;
      --text: #264653;
      --white: #ffffff;
    }

    * {
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      padding: 20px;
      background-color: var(--bg);
      color: var(--text);
    }

    h2, h3 {
      color: var(--primary);
      margin-top: 0;
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
      background-color: var(--white);
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }

    .form-group,
    .form-section {
      margin-bottom: 20px;
    }

    select, input[type="number"], button {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      margin-bottom: 10px;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 8px;
    }

    select[multiple] {
      height: auto;
    }

    button {
      background-color: var(--primary);
      color: var(--white);
      border: none;
      cursor: pointer;
      transition: background 0.3s ease;
    }

    button:hover {
      background-color: #21867a;
    }

    .danger {
      background-color: var(--danger);
    }

    .danger:hover {
      background-color: #c8563c;
    }

    .category-block {
      background-color: #eef6f6;
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 15px;
    }

    #confirmationSection {
      background-color: #fff8e1;
      border: 1px solid #f0d26b;
      padding: 15px;
      border-radius: 10px;
    }

    .expense-item {
      padding: 8px;
      border-bottom: 1px solid #ccc;
    }

    #chartContainer {
      margin-top: 30px;
      background: #fff;
      padding: 20px;
      border-radius: 10px;
    }

    @media (max-width: 600px) {
      select, input[type="number"], button {
        font-size: 15px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>Expense Tracker (Multi-Category)</h2>

    <div class="form-group">
      <label for="categories">Select Categories:</label>
      <select id="categories" multiple size="6" onchange="renderCategoryInputs()">
        <option value="housing">Housing</option>
        <option value="transportation">Transportation</option>
        <option value="groceries">Groceries</option>
        <option value="debt">Debt</option>
        <option value="eating out">Eating Out</option>
        <option value="entertainment">Entertainment</option>
        <option value="personal care">Personal Care</option>
        <option value="education">Education</option>
        <option value="gifts and donation">Gifts and Donation</option>
      </select>
    </div>

    <form id="expenseForm">
      <div id="categoryInputs" class="form-section"></div>
      <button type="button" onclick="confirmExpenses()">Review Expenses</button>
    </form>

    <div id="confirmationSection" class="form-section" style="display:none;">
      <h3>Confirm These Expenses:</h3>
      <ul id="confirmationList"></ul>
      <button onclick="saveExpenses()">Confirm & Save</button>
      <button onclick="cancelConfirmation()" class="danger">Cancel</button>
    </div>

    <div id="expenses" class="form-section">
      <h3>Saved Expense History:</h3>
      <div id="summary"></div>
      <button onclick="clearAllExpenses()" class="danger">ðŸ§¹ Clear All Expenses</button>
    </div>

    <div id="chartContainer">
      <h3>ðŸ“Š Expense Distribution</h3>
      <canvas id="expenseChart" width="400" height="300"></canvas>
    </div>
  </div>

  <script>
    const defaultOptions = {
      "transportation": [70, 80, 90, 100],
      "eating out": [150, 200, 250]
    };

    let expenses = JSON.parse(localStorage.getItem("expenses")) || [];
    let pendingExpenses = [];
    let chart;

    function renderCategoryInputs() {
      const selected = Array.from(document.getElementById("categories").selectedOptions).map(opt => opt.value);
      const container = document.getElementById("categoryInputs");
      container.innerHTML = "";

      selected.forEach(category => {
        const block = document.createElement("div");
        block.className = "category-block";

        block.innerHTML = `
          <strong>${capitalize(category)}</strong><br>
          ${defaultOptions[category] ? renderDefaultSelect(category) : ""}
          <label>Custom Amount (optional):</label>
          <input type="number" name="custom-${category}" placeholder="e.g. 100" />
        `;

        container.appendChild(block);
      });
    }

    function renderDefaultSelect(category) {
      let options = defaultOptions[category]
        .map(val => `<option value="${val}">$${val}</option>`)
        .join("");
      return `
        <label>Select Default Amount:</label>
        <select name="default-${category}">${options}</select>
      `;
    }

    function confirmExpenses() {
      pendingExpenses = [];
      const selected = Array.from(document.getElementById("categories").selectedOptions).map(opt => opt.value);
      const form = document.getElementById("expenseForm");

      selected.forEach(category => {
        const defaultInput = form.querySelector(`[name="default-${category}"]`);
        const customInput = form.querySelector(`[name="custom-${category}"]`);
        const defaultAmount = defaultInput ? parseFloat(defaultInput.value) : NaN;
        const customAmount = parseFloat(customInput.value);

        let amount = NaN;
        if (!isNaN(customAmount) && customAmount > 0) {
          amount = customAmount;
        } else if (!isNaN(defaultAmount)) {
          amount = defaultAmount;
        }

        if (!isNaN(amount) && amount > 0) {
          pendingExpenses.push({
            category,
            amount,
            timestamp: new Date().toLocaleString()
          });
        }
      });

      if (pendingExpenses.length === 0) {
        alert("Please enter at least one valid amount.");
        return;
      }

      const confirmList = document.getElementById("confirmationList");
      confirmList.innerHTML = "";
      pendingExpenses.forEach(item => {
        const li = document.createElement("li");
        li.textContent = `${capitalize(item.category)} - $${item.amount.toFixed(2)} at ${item.timestamp}`;
        confirmList.appendChild(li);
      });

      document.getElementById("confirmationSection").style.display = "block";
    }

    function saveExpenses() {
      expenses = expenses.concat(pendingExpenses);
      localStorage.setItem("expenses", JSON.stringify(expenses));
      pendingExpenses = [];
      document.getElementById("confirmationSection").style.display = "none";
      document.getElementById("expenseForm").reset();
      document.getElementById("categoryInputs").innerHTML = "";
      updateSummary();
    }

    function cancelConfirmation() {
      pendingExpenses = [];
      document.getElementById("confirmationSection").style.display = "none";
    }

    function clearAllExpenses() {
      if (confirm("Are you sure you want to delete all expenses?")) {
        expenses = [];
        localStorage.removeItem("expenses");
        updateSummary();
      }
    }

    function updateSummary() {
      const summaryDiv = document.getElementById("summary");
      summaryDiv.innerHTML = "";

      if (expenses.length === 0) {
        summaryDiv.innerHTML = "<p>No expenses recorded yet.</p>";
        updateChart();
        return;
      }

      expenses.forEach(item => {
        const div = document.createElement("div");
        div.className = "expense-item";
        div.innerHTML = `<strong>${capitalize(item.category)}</strong> - $${item.amount.toFixed(2)}<br><small>${item.timestamp}</small>`;
        summaryDiv.appendChild(div);
      });

      updateChart();
    }

    function updateChart() {
      const totals = {};

      expenses.forEach(({ category, amount }) => {
        totals[category] = (totals[category] || 0) + amount;
      });

      const categories = Object.keys(totals);
      const values = categories.map(c => totals[c]);

      const colors = [
        '#FF6384', '#36A2EB', '#FFCE56', '#8E44AD', '#2ECC71',
        '#E67E22', '#1ABC9C', '#C0392B', '#3498DB'
      ];

      const ctx = document.getElementById('expenseChart').getContext('2d');
      if (chart) chart.destroy();

      chart = new Chart(ctx, {
        type: 'pie',
        data: {
          labels: categories.map(capitalize),
          datasets: [{
            data: values,
            backgroundColor: colors.slice(0, categories.length)
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: {
              position: 'bottom'
            }
          }
        }
      });
    }

    function capitalize(text) {
      return text.charAt(0).toUpperCase() + text.slice(1);
    }

    document.addEventListener("DOMContentLoaded", () => {
      updateSummary();
    });
  </script>
</body>
</html>
